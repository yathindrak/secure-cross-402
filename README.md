# A2A x402 Polygon Amoy Project

## Overview
This project showcases **Agent-to-Agent (A2A)** cooperation using the **x402 payment protocol**. Independent agents work together to request and pay for premium HTTP resources, with payments settled on **Polygon Amoy testnet** (chainId 80002) using an EIP-3009 style transferWithAuthorization flow.

***

## Architecture Components

### **Core Services**

| Component         | Location             | Description                                                                                              |
|-------------------|----------------------|----------------------------------------------------------------------------------------------------------|
| **Facilitator**   | `apps/facilitator`   | Verifies payment payloads and optionally broadcasts settlement transactions on Amoy                        |
| **Resource Server** | `apps/resource-server` | Exposes premium endpoint (`/premium/summarize`) and returns 402 challenges with PaymentRequirements      |
| **Service Agent** | `apps/service-agent` | A2A server implementing minimal JSON-RPC message/send functionality and proxying premium requests          |
| **Client Agent**  | `apps/client-agent`  | A2A client that handles message sending, 402 responses, EIP-712 X-PAYMENT payload construction, and retries |

***

## Quick Start Guide

### Prerequisites
- Configured `.env` files for each service in their respective `apps/` directories with:
  - Private keys (**testnet only**)
  - Amoy RPC endpoint
  - Token contract address

### Launch Instructions
1. **Setup Environment**
   ```bash
   # Create .env files for each service in apps/<service-name> based on env.example
   # WARNING: Never commit real keys to version control
   ```

2. **Compile Packages**
   ```bash
   # From repository root
   bun install
   bun run build
   ```

3. **Start All Services**

   ```bash
   # Terminal 1 - Start Facilitator
   cd apps/facilitator
   bun start

   # Terminal 2 - Start Resource Server
   cd apps/resource-server
   bun start

   # Terminal 3 - Start Service Agent
   cd apps/service-agent
   bun start

   # Terminal 4 - Start Client Agent
   cd apps/client-agent
   bun start
   ```

   **Note**: Each service runs on a different port. Check individual service logs for port assignments and startup status.

***

## Documentation & Logs

### **Detailed Documentation**
- **Technical specifications**: `x402_polygon_demo/technical.md`
- **Design decisions and implementation details**

### **Runtime Monitoring**
Log files are generated by each service. Refer to individual service documentation for details.

***

## Security Considerations

### **Important Safety Notes**

- **Testnet Only**: This project currently uses Polygon Amoy testnet. Deploying to mainnet requires careful consideration and audits.
- **Test Accounts**: Only use funded test accounts for development and testing.
- **No Mainnet**: Never use mainnet keys or addresses with this project in its current state.
- **Production Ready**: The current implementation contains simplified logic and in-memory nonce handling. It is **not suitable for production use** without further development, security audits, and robust nonce management.

### **Best Practices**
- Keep private keys secure and never commit to public repositories.
- Use dedicated test accounts for all development and testing activities.
- Implement robust key management and secret storage solutions for production environments.
- Ensure all smart contracts are thoroughly audited before mainnet deployment.

***

## Next Steps

For advanced configuration, contributions, or further development, refer to individual component documentation and the technical specifications in `x402_polygon_demo/technical.md`.
